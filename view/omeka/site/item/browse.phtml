<?php
$translate = $this->plugin('translate');
$escape = $this->plugin('escapeHtml');
$this->htmlElement('body')->appendAttribute('class', 'item resource browse');

$query = $this->params()->fromQuery();
$itemSetShow = isset($itemSet);
if ($itemSetShow):
    $this->htmlElement('body')->appendAttribute('class', 'item-set');
    $query['item_set_id'] = $itemSet->id();
endif;
$sortHeadings = [
    [
        'label' => $translate('Title'),
        'value' => 'dcterms:title'
    ],
    [
        'label' => $translate('Identifier'),
        'value' => 'dcterms:identifier'
    ],
    [
        'label' => $translate('Class'),
        'value' => 'resource_class_label'
    ],
    [
        'label' => $translate('Created'),
        'value' => 'created'
    ],
];
?>

<?php if ($itemSetShow): ?>
    <?php echo $this->pageTitle($itemSet->displayTitle(), 2); ?>
    <h3><?php echo $translate('Item set'); ?></h3>
    <div class="metadata">
        <?php echo $itemSet->displayValues(); ?>
    </div>
    <div class="item-set-items">
    <?php echo '<h3>' . $escape($translate('Items')) . '</h3>'; ?>
<?php else: ?>
    <?php echo $this->pageTitle($translate('Items'), 2); ?>
<?php endif; ?>

<?php echo $this->searchFilters(); ?>

<div class="browse-controls">
    <?php echo $this->pagination(); ?>
    <?php echo $this->hyperlink($translate('Advanced search'), $this->url('site/resource', ['controller' => 'item', 'action' => 'search'], ['query' => $query], true), ['class' => 'advanced-search']); ?>
    <?php echo $this->sortSelector($sortHeadings); ?>
</div>

<?php $this->trigger('view.browse.before'); ?>

<div class="grid-x">
    <div class="horse-filters" data-sticky-container>
      <ul class="sticky" data-sticky data-top-anchor="resource-list">
        <li>Filter by:
        <ul>
          <li><a href="#">Decade</a></li>
          <li><a href="#">Country</a></li>
          <li><a href="#">Media type</a></li>
        </ul>
        </li>
    </div>
    
    <ul class="resource-list" id="resource-list">
    <?php
    $headingTerm = $this->siteSetting('browse_heading_property_term');
    $bodyTerm = $this->siteSetting('browse_body_property_term');
    foreach ($items as $item):
        $heading = $headingTerm ? $item->value($headingTerm, ['default' => $translate('[Untitled]')]) : $item->displayTitle();
        $body = $bodyTerm ? $item->value($bodyTerm) : $item->displayDescription();
    ?>
        <li class="item resource media-object">
            <div class="media-object-section resource-image">
                <?php if ($thumbnail = $this->thumbnail($item, 'medium')): ?>
                <?php echo $item->linkRaw($thumbnail, null, ['class' => 'thumbnail']); ?>
                <?php endif; ?>
            </div>
            <div class="media-object-section resource-meta">
                <h4><?php echo $item->link($heading); ?></h4>
                <?php if ($body): ?>
                <div class="description"><?php echo $body; ?></div>
            </div>
            <?php endif; ?>
        </li>
    <?php endforeach; ?>
    </ul>

</dv>
<?php echo ($itemSetShow) ? '</div>' : ''; ?>
<?php $this->trigger('view.browse.after'); ?>

<div class="browse-controls">
    <?php echo $this->pagination(); ?>
</div>